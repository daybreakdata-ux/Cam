<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ONVIF Camera Grid</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.json" />
  <style>
    body { margin:0; font-family: system-ui, sans-serif; background:#111; color:#eee; }
    header { padding: 1rem; background:#222; display:flex; gap:1rem; align-items:center; flex-wrap:wrap; }
    input, button { padding:0.4rem 0.6rem; border-radius:4px; border:1px solid #444; background:#000; color:#eee; }
    button { cursor:pointer; border-color:#0af; }
    button:hover { background:#0af; color:#000; }
    button.secondary { border-color:#666; }
    button.secondary:hover { background:#666; color:#fff; }
    main { padding:1rem; }
    .actions { display:flex; gap:0.5rem; margin:1rem; flex-wrap:wrap; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:1rem; }
    .card { background:#181818; border-radius:8px; padding:0.75rem; border:1px solid #333; display:flex; flex-direction:column; gap:0.5rem; position:relative; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
    .video-container { position:relative; width:100%; aspect-ratio:16/9; background:#000; border-radius:4px; overflow:hidden; }
    .video-container img { width:100%; height:100%; object-fit:contain; }
    .live-indicator { position:absolute; top:8px; right:8px; background:rgba(255,0,0,0.8); color:white; padding:2px 6px; border-radius:4px; font-size:0.7rem; font-weight:bold; pointer-events:none; }
    .card .card-actions { display:flex; gap:0.5rem; margin-top:auto; }
    .card .card-actions button { flex:1; font-size:0.8rem; padding:0.4rem; }
    .meta { font-size:0.8rem; color:#ccc; }
    .note { padding: 1rem; background:#222; border-left: 3px solid #0af; margin: 1rem; font-size:0.9rem; }
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; overflow:auto; }
    .modal.active { display:flex; align-items:center; justify-content:center; }
    .modal-content { background:#181818; border-radius:8px; padding:1.5rem; max-width:600px; width:90%; max-height:90vh; overflow:auto; border:1px solid #333; }
    .modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; }
    .modal-header h2 { margin:0; font-size:1.2rem; }
    .close { cursor:pointer; font-size:1.5rem; color:#888; }
    .close:hover { color:#fff; }
    .info-section { margin:1rem 0; padding:0.75rem; background:#222; border-radius:4px; }
    .info-section h3 { margin:0 0 0.5rem 0; font-size:0.9rem; color:#0af; }
    .info-line { display:flex; gap:0.5rem; margin:0.3rem 0; font-size:0.85rem; }
    .info-label { color:#888; min-width:80px; }
    .info-value { color:#eee; word-break:break-all; flex:1; }
    .copy-btn { cursor:pointer; color:#0af; text-decoration:underline; font-size:0.8rem; }
    .copy-btn:hover { color:#fff; }
    .permission-banner { background:#f80; color:#000; padding:0.75rem 1rem; text-align:center; font-weight:bold; }
  </style>
</head>
<body>
  <div class="permission-banner" id="permissionBanner" style="display:none;">
    游 This app requires network access to discover cameras on your local network. Click "Discover Cameras" to proceed.
  </div>
  <header>
    <div>
      <label>Username <input id="user" placeholder="admin" /></label>
      <label>Password <input id="pass" type="password" placeholder="password" /></label>
    </div>
    <button id="discoverBtn">Discover Cameras</button>
    <span id="status"></span>
  </header>
  <main>
    <div class="note">
      <strong>丘멆잺 Important:</strong> ONVIF discovery requires UDP multicast on your local network. 
      This works best when running locally. For hosted deployments, you may need to manually enter camera IPs.
    </div>
    <div class="actions" id="actions" style="display:none;">
      <button id="exportAllBtn" class="secondary">游닌 Export All RTSP URLs</button>
      <button id="exportBlueIrisBtn" class="secondary">游닌 Blue Iris Config</button>
      <button id="exportFrigateBtn" class="secondary">游닌 Frigate Config</button>
      <button id="exportHomeAssistantBtn" class="secondary">游닌 Home Assistant Config</button>
    </div>
    <div class="grid" id="grid"></div>
  </main>
  
  <!-- Modal for camera details -->
  <div class="modal" id="cameraModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Camera Details</h2>
        <span class="close" id="closeModal">&times;</span>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>
  <script src="app.js"></script>
</body>
</html>
